<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Movie Ticketing</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="booking.html">Book Tickets</a></li>
                    <li><a href="login.html" aria-current="page">Login</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <section class="login">
            <div class="container login-wrapper">
                <div class="login-copy">
                    <h2>Hi! Welcome</h2>
                    <p>Sign up to manage your reservations, view upcoming showtimes, and keep track of your favourite movies.</p>
                </div>
                <form id="register-form" class="login-form" novalidate>
                    <label for="fullname">Full name</label>
                    <input type="text" id="fullname" name="fullname" placeholder="Your full name" required>

                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="you@example.com" required>

                    <div class="label-row">
                        <label for="password">Password</label>
                        <small class="muted">min 6 characters</small>
                    </div>
                    <input type="password" id="password" name="password" placeholder="Choose a password" required minlength="6">

                    <label for="confirm">Confirm password</label>
                    <input type="password" id="confirm" name="confirm" placeholder="Re-enter your password" required minlength="6">

                    <div id="form-error" role="alert" aria-live="assertive" style="display:none;color:#b91c1c;font-weight:600"></div>

                    <button type="submit" class="btn">Create account</button>
                    <p class="form-footer">Already have an account? <a href="login.html" class="link">Log in</a></p>
                </form>
                <script>
                    (function(){
                        const form = document.getElementById('register-form');
                        const pw = document.getElementById('password');
                        const confirm = document.getElementById('confirm');
                        const err = document.getElementById('form-error');

                        function showError(message){
                            err.textContent = message;
                            err.style.display = 'block';
                        }

                        function clearError(){
                            err.textContent = '';
                            err.style.display = 'none';
                        }
                        //berjalan saat tombol submit ditekan.
                        form.addEventListener('submit', async function(e){
                            e.preventDefault();//mencegah halaman reload
                            clearError();
                            if(!form.checkValidity()){ //input valid
                                showError('Please fill out all required fields correctly.');
                                return;
                            }
                            if(pw.value.length < 6){
                                showError('Password must be at least 6 characters long.');
                                return;
                            }
                            if(pw.value !== confirm.value){
                                showError('Passwords do not match.');
                                return;
                            }

                            const payload = { fullname: form.fullname.value, email: form.email.value, password: pw.value };
                            try{
                                const res = await fetch('/api/register', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) }); //ubah objek JavaScript ke JSON st
                                const json = await res.json(); //baca balasan dari server dalam format json
                                if(!json.ok){ showError(json.message || 'Registration failed'); return; } //tampilkan pesan error
                                alert('Account created â€” you can now log in');
                                window.location.href = '/login.html';
                            }catch(err){ showError('Network error'); }
                        });
                    })();
                </script>
            </div>
        </section>
    </main>
</body>
</html>